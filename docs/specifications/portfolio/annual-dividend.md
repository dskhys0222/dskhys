# ポートフォリオ年間配当予想金額表示機能 - 仕様書

## 1. データモデル

### Stock 型の拡張

既存の `Stock` インターフェースに以下を追加：

```typescript
export interface Stock {
  // ... 既存フィールド

  // 配当金関連
  includeDividend?: boolean; // 配当金集計対象フラグ（デフォルト: false）
  dividendAmount?: number; // 年間配当金額（円）
  dividendYield?: number; // 配当利回り（%）
  lastDividendDate?: string; // 直近配当金の支払い日（ISO 8601）
}
```

### 新規型定義

```typescript
// 配当金情報
export interface DividendInfo {
  annualAmount: number; // 年間配当金額（円）
  yieldPercent: number; // 配当利回り（%）
  stockCount: number; // 配当対象銘柄数
  stockDetails: {
    stockId: string;
    name: string;
    ticker: string;
    amount: number;
    yield: number;
  }[];
}
```

## 2. UI/UX 仕様

### 2.1 サマリー画面の配置

```txt
┌─────────────────────────────────────────┐
│  年間配当予想金額                        │
│  ┌───────────────────────────────────┐  │
│  │ 合計: ¥1,234,567                   │  │  <- メインのKPI
│  │ 配当利回り: 3.45%                  │  │  <- サブ情報
│  │ 対象銘柄: 12件                     │  │  <- 件数表示
│  └───────────────────────────────────┘  │
│                                          │
│  [既存のグラフ類...]                     │
│                                          │
└─────────────────────────────────────────┘
```

### 2.2 銘柄への配当金入力 UI

- 銘柄詳細画面またはストック一覧画面に以下を追加
  - 「配当金を集計対象にする」チェックボックス
  - 「年間配当金額」入力フィールド（数値）
  - 「直近配当日」入力フィールド（日付）

### 2.3 配当金詳細表示

- サマリー画面の配当金セクションをクリックで、配当対象銘柄の詳細リストを展開
  - 銘柄名
  - ティッカー
  - 年間配当金額
  - 配当利回り

## 3. ビジネスロジック

### 3.1 年間配当予想金額の計算

```txt
年間配当予想金額 = Σ(dividendAmount) ｜ includeDividend = true
```

### 3.2 配当利回りの計算（フォーム入力後）

```txt
個別利回り (%) = (dividendAmount ÷ evaluationValue) × 100
全体利回り (%) = (合計配当金 ÷ ポートフォリオ評価額) × 100
```

### 3.3 データ永続化

- ローカルストレージに保存
- 既存の `useStocksStore` に統合
- stock オブジェクトにネストされた形式で保存

## 4. API 仕様（拡張用）

### Phase 2 で実装予定

#### GET /api/dividends/:ticker

配当金情報を外部 API から取得

```json
{
  "ticker": "1234",
  "name": "Sample Corp",
  "dividends": [
    {
      "date": "2024-01-01",
      "amount": 100,
      "currency": "JPY"
    }
  ],
  "annualAmount": 400
}
```

## 5. 実装の優先順位

1. **高**: Stock 型の拡張、ローカルストレージ対応
2. **高**: サマリー画面での表示ロジック
3. **中**: 銘柄管理画面での入力 UI
4. **低**: 自動取得機能

## 6. テスト仕様

### ユニットテスト

- 配当金計算ロジックの検証
- 配当利回り計算の検証
- ローカルストレージ保存/読み込みの検証

### UI テスト

- サマリー画面での配当金表示確認
- チェックボックスのトグル動作
- 数値入力の妥当性チェック
