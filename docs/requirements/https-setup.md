# HTTPS 対応 要件定義書

## 概要

デプロイ先サーバーを HTTPS 対応し、Let's Encrypt を使用した自動証明書更新を実現する。
GitHub Actions 経由でサーバーのセットアップを自動化する。

## 背景

- 現在のデプロイ環境は HTTP（ポート 80）のみで通信している
- 本番環境ではセキュリティ上 HTTPS 通信が必須
- SSL 証明書の手動更新は運用負荷が高い

## 機能要件

### FR-001: HTTPS 通信の有効化

- Nginx でポート 443 の HTTPS 通信を受け付ける
- TLS 1.2 以上をサポートする
- 適切な暗号スイートを設定する

### FR-002: HTTP から HTTPS へのリダイレクト

- ポート 80 への HTTP リクエストを HTTPS（ポート 443）へ自動リダイレクトする

### FR-003: Let's Encrypt 証明書の取得

- Let's Encrypt を使用して SSL 証明書を取得する
- Certbot を使用して証明書取得を自動化する
- ACME チャレンジ（HTTP-01）に対応する

### FR-004: 証明書の自動更新

- 証明書の有効期限前に自動更新を行う
- 更新後、Nginx に証明書を自動で反映する
- 更新処理は Docker コンテナ内で完結する

### FR-005: GitHub Actions によるサーバーセットアップ

- 初回 SSL 証明書取得を GitHub Actions 経由で実行可能にする
- セットアップワークフローを手動実行（workflow_dispatch）可能にする
- 必要なシークレット（ドメイン名、メールアドレス等）を GitHub Secrets で管理する

## 非機能要件

### NFR-001: 可用性

- 証明書更新時にサービス停止しない
- 証明書取得失敗時も HTTP でのアクセスを維持する（初回セットアップ時）

### NFR-002: セキュリティ

- HSTS（HTTP Strict Transport Security）ヘッダーを設定する
- セキュリティヘッダー（X-Content-Type-Options, X-Frame-Options 等）を追加する
- 安全な暗号スイートのみを許可する

### NFR-003: 運用性

- 証明書・秘密鍵は Docker ボリュームで永続化する
- ログで証明書更新状況を確認可能にする
- Docker ベースでセットアップを完結させる

### NFR-004: 互換性

- 既存のデプロイワークフローとの互換性を維持する
- 既存の環境変数・シークレット設定を活用する
